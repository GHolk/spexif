// Generated by CoffeeScript 1.12.1
(function() {
  var createInfoNode, template, updateExif;

  template = (function() {
    var node;
    node = document.getElementById('template').getElementsByClassName('image-template')[0].cloneNode(true);
    node.className = 'image-info';
    return node;
  })();

  updateExif = function(image, text) {
    var exif, exifArray;
    exifArray = text.split(/\n/g);
    exifArray[2] = exifArray[2].split(/,/).map(function(s) {
      return Number(s);
    });
    exif = image.exif;
    exif.date = exifArray[0], exif.maker = exifArray[1], exif.gps = exifArray[2];
    image.exif.update();
    image.change = new Date();
    return spexif.imageManager.updatePoint(image);
  };

  createInfoNode = function(cacheImage) {
    var exif, newNode, textarea;
    newNode = template.cloneNode(true);
    newNode.getElementsByTagName('img')[0].src = cacheImage.thumbnailImage.url;
    exif = cacheImage.exif;
    textarea = newNode.getElementsByTagName('textarea')[0];
    textarea.value = (exif.date.trim()) + "\n" + (exif.maker.trim()) + "\n" + (exif.gps.toString().trim());
    textarea.addEventListener('change', function() {
      return updateExif(cacheImage, this.value);
    });
    return newNode;
  };

  spexif.domHelper = {
    createInfoNode: createInfoNode
  };

}).call(this);
