
fs = require 'fs'

router = Object.create null

routeFileType = (pathname, httpCode, contentType) ->
    (res) ->
        res.writeHead httpCode, {'Content-Type': contentType}
        fs.createReadStream(pathname).pipe res
        console.log "send #{pathname}"

router.error = routeFileType '404.txt', 404, 'text/plain'

router['/index.html'] = routeFileType 'index.html', 200, 'text/html'
router['/ext/style.css'] = routeFileType 'ext/style.css', 200, 'text/css'
router['/'] = router['/index.html']
for scriptFile in [
    'cacheImage.js'
    'domHelper.js'
    'errorSpeaker.js'
    'filterPiexif.js'
    'googleMapWraper.js'
    'imageList.js'
    'inputFile.js'
    'piexif.js'
]
    router["/ext/#{scriptFile}"] = routeFileType(
        "ext/#{scriptFile}"
        200
        'application/javascript'
    )


route = (res, pathname, query) ->
    if typeof router[pathname] == 'function'
        console.log "route to #{pathname}"
        router[pathname] res, query
    else
        console.log "no route, to 404.txt"
        router.error res


exports.route = route

